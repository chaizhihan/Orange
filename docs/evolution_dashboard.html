<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALIN Evolution Dashboard - é€»è¾‘è¿›åŒ–ä»ªè¡¨ç›˜</title>
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --bg-hover: #1a1a24;
            --accent: #8b5cf6;
            --accent-glow: rgba(139, 92, 246, 0.4);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --text: #f1f5f9;
            --text-dim: #64748b;
            --border: #2a2a3a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(180deg, var(--bg-card), transparent);
        }

        .header h1 {
            font-size: 1.4rem;
            background: linear-gradient(135deg, var(--accent), #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .evolve-btn {
            background: linear-gradient(135deg, var(--accent), #ec4899);
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 9999px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s;
            box-shadow: 0 0 20px var(--accent-glow);
        }

        .evolve-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px var(--accent-glow);
        }

        .main {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1rem;
            padding: 1rem;
            height: calc(100vh - 70px);
        }

        .panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 1rem;
            overflow: hidden;
        }

        .panel-header {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .badge {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            background: var(--accent);
        }

        .left-col {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .right-col {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* æ‹“æ‰‘å›¾ */
        #topology {
            flex: 1;
            position: relative;
        }

        #topology-canvas {
            width: 100%;
            height: 100%;
        }

        /* çƒ­æ’æ‹”é¢æ¿ */
        .slots {
            display: flex;
            gap: 0.5rem;
            padding: 1rem;
            flex-wrap: wrap;
        }

        .slot {
            width: 80px;
            height: 80px;
            border: 2px dashed var(--border);
            border-radius: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .slot.active {
            border-style: solid;
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }

        .slot.active::after {
            content: '';
            position: absolute;
            top: -4px;
            right: -4px;
            width: 12px;
            height: 12px;
            background: var(--success);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--success);
        }

        .slot:hover {
            border-color: var(--accent);
            background: var(--bg-hover);
        }

        .slot-name {
            font-size: 0.65rem;
            color: var(--text-dim);
            margin-top: 0.25rem;
        }

        .slot-icon {
            font-size: 1.5rem;
        }

        .slot.empty .slot-icon {
            color: var(--text-dim);
        }

        /* ç°åº¦å‘å¸ƒ */
        .canary-container {
            padding: 1rem;
        }

        .canary-bar {
            height: 30px;
            background: var(--border);
            border-radius: 4px;
            display: flex;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .canary-v1 {
            background: var(--success);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .canary-v2 {
            background: var(--accent);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .canary-slider {
            width: 100%;
            margin: 0.5rem 0;
        }

        .canary-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        /* ç‰ˆæœ¬æ—¶é—´è½´ */
        .timeline {
            padding: 1rem;
        }

        .timeline-track {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            overflow-x: auto;
            padding: 0.5rem 0;
        }

        .timeline-node {
            min-width: 60px;
            padding: 0.5rem;
            background: var(--bg-hover);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .timeline-node.current {
            border-color: var(--accent);
            background: rgba(139, 92, 246, 0.2);
            box-shadow: 0 0 15px var(--accent-glow);
        }

        .timeline-node:hover {
            border-color: var(--accent);
        }

        .timeline-node .version {
            font-size: 0.8rem;
            font-weight: 600;
        }

        .timeline-node .hash {
            font-size: 0.6rem;
            color: var(--text-dim);
        }

        .timeline-arrow {
            color: var(--text-dim);
        }

        /* å…ƒæ•°æ®é¢æ¿ */
        .meta-panel {
            padding: 1rem;
            font-size: 0.75rem;
        }

        .meta-panel pre {
            background: var(--bg-dark);
            padding: 0.75rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            color: var(--success);
        }

        /* è‡ªæ„ˆæ¼”ç¤º */
        .resilience {
            padding: 1rem;
        }

        .resilience-status {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success);
            box-shadow: 0 0 10px var(--success);
        }

        .status-indicator.crashed {
            background: var(--danger);
            box-shadow: 0 0 10px var(--danger);
            animation: pulse 0.5s infinite;
        }

        .status-indicator.recovering {
            background: var(--warning);
            box-shadow: 0 0 10px var(--warning);
            animation: pulse 0.3s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .crash-btn {
            background: var(--danger);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.75rem;
        }

        .recovery-time {
            font-size: 0.85rem;
            color: var(--success);
        }

        /* ååé‡å›¾è¡¨ */
        .throughput {
            height: 80px;
            padding: 0.5rem 1rem;
        }

        .throughput-bars {
            display: flex;
            align-items: flex-end;
            height: 100%;
            gap: 2px;
        }

        .throughput-bar {
            flex: 1;
            background: linear-gradient(180deg, var(--accent), var(--success));
            border-radius: 2px 2px 0 0;
            transition: height 0.3s;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>âš›ï¸ ALIN Evolution Dashboard</h1>
        <button class="evolve-btn" onclick="evolve()">ğŸ§¬ è¿›åŒ– (Evolve)</button>
    </div>

    <div class="main">
        <div class="left-col">
            <!-- å®æ—¶æ‹“æ‰‘å›¾ -->
            <div class="panel" style="flex: 2;">
                <div class="panel-header">
                    <span>ğŸ“Š å®æ—¶æ‹“æ‰‘å›¾ (Live Topology)</span>
                    <span class="badge">4 Nodes</span>
                </div>
                <div id="topology">
                    <canvas id="topology-canvas"></canvas>
                </div>
            </div>

            <!-- çƒ­æ’æ‹”é¢æ¿ -->
            <div class="panel">
                <div class="panel-header">
                    <span>ğŸ”Œ é€»è¾‘æ’æ§½ (Logic Slots)</span>
                    <span style="font-size: 0.7rem; color: var(--text-dim);">æ‹–æ‹½ä»¥æ’æ‹”</span>
                </div>
                <div class="slots" id="slots">
                    <div class="slot active" data-node="parse_json">
                        <span class="slot-icon">ğŸ“</span>
                        <span class="slot-name">01_parse</span>
                    </div>
                    <div class="slot active" data-node="filter_level">
                        <span class="slot-icon">ğŸ”</span>
                        <span class="slot-name">02_filter</span>
                    </div>
                    <div class="slot active" data-node="agg_count">
                        <span class="slot-icon">ğŸ“Š</span>
                        <span class="slot-name">03_agg</span>
                    </div>
                    <div class="slot active" data-node="alert_console">
                        <span class="slot-icon">ğŸ””</span>
                        <span class="slot-name">04_alert</span>
                    </div>
                    <div class="slot empty" onclick="addSlot()">
                        <span class="slot-icon">+</span>
                        <span class="slot-name">æ·»åŠ æ’æ§½</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-col">
            <!-- ç°åº¦å‘å¸ƒ -->
            <div class="panel">
                <div class="panel-header">
                    <span>ğŸ¨ ç°åº¦å‘å¸ƒ (Canary)</span>
                </div>
                <div class="canary-container">
                    <div class="canary-bar">
                        <div class="canary-v1" id="canary-v1" style="width: 90%;">v1 (90%)</div>
                        <div class="canary-v2" id="canary-v2" style="width: 10%;">v2</div>
                    </div>
                    <input type="range" class="canary-slider" min="0" max="100" value="10"
                        onchange="updateCanary(this.value)">
                    <div class="canary-label">
                        <span>â† ä¿å®ˆ (v1)</span>
                        <span>æ¿€è¿› (v2) â†’</span>
                    </div>
                </div>
            </div>

            <!-- è‡ªæ„ˆæ¼”ç¤º -->
            <div class="panel">
                <div class="panel-header">
                    <span>ğŸ’ª æé€Ÿè‡ªæ„ˆ (Resilience)</span>
                </div>
                <div class="resilience">
                    <div class="resilience-status">
                        <div class="status-indicator" id="status-indicator"></div>
                        <span id="status-text">ç³»ç»Ÿæ­£å¸¸è¿è¡Œ</span>
                        <button class="crash-btn" onclick="simulateCrash()">æ¨¡æ‹Ÿå´©æºƒ</button>
                    </div>
                    <div class="recovery-time" id="recovery-time" style="margin-top: 0.5rem;"></div>
                </div>
            </div>

            <!-- ç‰ˆæœ¬æ—¶é—´è½´ -->
            <div class="panel">
                <div class="panel-header">
                    <span>â±ï¸ ç‰ˆæœ¬æ—¶é—´è½´ (Timeline)</span>
                </div>
                <div class="timeline">
                    <div class="timeline-track" id="timeline">
                        <div class="timeline-node" onclick="switchVersion(1)">
                            <div class="version">v1</div>
                            <div class="hash">abc123</div>
                        </div>
                        <span class="timeline-arrow">â†’</span>
                        <div class="timeline-node" onclick="switchVersion(2)">
                            <div class="version">v2</div>
                            <div class="hash">def456</div>
                        </div>
                        <span class="timeline-arrow">â†’</span>
                        <div class="timeline-node current" onclick="switchVersion(3)">
                            <div class="version">v3</div>
                            <div class="hash">ghi789</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å…ƒæ•°æ®é¢æ¿ -->
            <div class="panel" style="flex: 1;">
                <div class="panel-header">
                    <span>ğŸ“‹ å…ƒæ•°æ® (.meta)</span>
                </div>
                <div class="meta-panel">
                    <pre id="meta-content"># ç‚¹å‡»èŠ‚ç‚¹æŸ¥çœ‹å…ƒæ•°æ®

[node]
name = filter_level
hash = abc12345
inode = 7335321

[ai_context]
çƒ­åˆ‡æ¢: ln -sf filter_v2 active/02</pre>
                </div>
            </div>

            <!-- ååé‡ -->
            <div class="panel">
                <div class="panel-header">
                    <span>ğŸ“ˆ ååé‡ (Throughput)</span>
                    <span style="font-size: 0.7rem;">1.2k/s</span>
                </div>
                <div class="throughput">
                    <div class="throughput-bars" id="throughput-bars"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ‹“æ‰‘å›¾ç»˜åˆ¶
        const canvas = document.getElementById('topology-canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            const container = document.getElementById('topology');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            drawTopology();
        }

        const nodes = [
            { id: 'input', x: 0.1, y: 0.5, label: 'stdin', color: '#64748b' },
            { id: 'parse', x: 0.3, y: 0.5, label: 'parse_json', hash: 'abc123', color: '#8b5cf6' },
            { id: 'filter', x: 0.5, y: 0.5, label: 'filter_level', hash: 'def456', color: '#8b5cf6', evolving: false },
            { id: 'agg', x: 0.7, y: 0.5, label: 'agg_count', hash: 'ghi789', color: '#8b5cf6' },
            { id: 'output', x: 0.9, y: 0.5, label: 'stdout', color: '#64748b' }
        ];

        let particles = [];

        function drawTopology() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶è¿çº¿
            ctx.strokeStyle = '#2a2a3a';
            ctx.lineWidth = 2;
            for (let i = 0; i < nodes.length - 1; i++) {
                ctx.beginPath();
                ctx.moveTo(nodes[i].x * canvas.width, nodes[i].y * canvas.height);
                ctx.lineTo(nodes[i + 1].x * canvas.width, nodes[i + 1].y * canvas.height);
                ctx.stroke();
            }

            // ç»˜åˆ¶ç²’å­
            ctx.fillStyle = '#10b981';
            particles.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, 4, 0, Math.PI * 2);
                ctx.fill();
            });

            // ç»˜åˆ¶èŠ‚ç‚¹
            nodes.forEach(node => {
                const x = node.x * canvas.width;
                const y = node.y * canvas.height;
                const radius = 30;

                // å‘å…‰æ•ˆæœ
                if (node.evolving) {
                    ctx.shadowColor = '#ec4899';
                    ctx.shadowBlur = 20;
                }

                // èŠ‚ç‚¹åœ†
                ctx.fillStyle = node.color;
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fill();

                ctx.shadowBlur = 0;

                // æ ‡ç­¾
                ctx.fillStyle = '#fff';
                ctx.font = '10px monospace';
                ctx.textAlign = 'center';
                ctx.fillText(node.label, x, y + 4);

                // Hash
                if (node.hash) {
                    ctx.fillStyle = '#64748b';
                    ctx.font = '8px monospace';
                    ctx.fillText(node.hash, x, y + 50);
                }
            });
        }

        // ç²’å­åŠ¨ç”»
        function animateParticles() {
            if (Math.random() < 0.1) {
                particles.push({
                    x: nodes[0].x * canvas.width,
                    y: nodes[0].y * canvas.height,
                    progress: 0
                });
            }

            particles = particles.filter(p => {
                p.progress += 0.02;
                if (p.progress >= 1) return false;

                const idx = Math.floor(p.progress * (nodes.length - 1));
                const nextIdx = Math.min(idx + 1, nodes.length - 1);
                const localProgress = (p.progress * (nodes.length - 1)) % 1;

                p.x = (nodes[idx].x + (nodes[nextIdx].x - nodes[idx].x) * localProgress) * canvas.width;
                p.y = (nodes[idx].y + (nodes[nextIdx].y - nodes[idx].y) * localProgress) * canvas.height;
                return true;
            });

            drawTopology();
            requestAnimationFrame(animateParticles);
        }

        // è¿›åŒ–åŠ¨ç”»
        function evolve() {
            const filterNode = nodes.find(n => n.id === 'filter');
            filterNode.evolving = true;
            filterNode.hash = 'NEW' + Math.random().toString(36).substr(2, 4);
            filterNode.color = '#ec4899';

            // æ›´æ–°æ—¶é—´è½´
            const timeline = document.getElementById('timeline');
            document.querySelectorAll('.timeline-node').forEach(n => n.classList.remove('current'));
            const newNode = document.createElement('span');
            newNode.className = 'timeline-arrow';
            newNode.textContent = 'â†’';
            timeline.appendChild(newNode);

            const versionNode = document.createElement('div');
            versionNode.className = 'timeline-node current';
            versionNode.innerHTML = `<div class="version">v${document.querySelectorAll('.timeline-node').length + 1}</div><div class="hash">${filterNode.hash}</div>`;
            timeline.appendChild(versionNode);

            setTimeout(() => {
                filterNode.evolving = false;
                filterNode.color = '#8b5cf6';
            }, 2000);
        }

        // ç°åº¦å‘å¸ƒ
        function updateCanary(value) {
            document.getElementById('canary-v1').style.width = (100 - value) + '%';
            document.getElementById('canary-v1').textContent = `v1 (${100 - value}%)`;
            document.getElementById('canary-v2').style.width = value + '%';
            document.getElementById('canary-v2').textContent = value > 20 ? `v2 (${value}%)` : '';
        }

        // æ¨¡æ‹Ÿå´©æºƒ
        function simulateCrash() {
            const indicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            const recoveryTime = document.getElementById('recovery-time');

            indicator.className = 'status-indicator crashed';
            statusText.textContent = 'âš ï¸ èŠ‚ç‚¹å´©æºƒ!';
            recoveryTime.textContent = '';

            const start = performance.now();

            setTimeout(() => {
                indicator.className = 'status-indicator recovering';
                statusText.textContent = 'ğŸ”„ è‡ªæ„ˆä¸­...';
            }, 100);

            setTimeout(() => {
                indicator.className = 'status-indicator';
                statusText.textContent = 'âœ… ç³»ç»Ÿå·²æ¢å¤';
                const elapsed = (performance.now() - start).toFixed(0);
                recoveryTime.textContent = `æ¢å¤è€—æ—¶: ${elapsed}ms (ln -sf åŸå­åˆ‡æ¢)`;
            }, 300);
        }

        // ç‰ˆæœ¬åˆ‡æ¢
        function switchVersion(v) {
            document.querySelectorAll('.timeline-node').forEach((n, i) => {
                n.classList.toggle('current', i === v - 1);
            });
        }

        // ååé‡å›¾
        function initThroughput() {
            const container = document.getElementById('throughput-bars');
            for (let i = 0; i < 30; i++) {
                const bar = document.createElement('div');
                bar.className = 'throughput-bar';
                bar.style.height = '20%';
                container.appendChild(bar);
            }

            setInterval(() => {
                const bars = container.querySelectorAll('.throughput-bar');
                bars.forEach(bar => {
                    bar.style.height = (20 + Math.random() * 60) + '%';
                });
            }, 500);
        }

        // æ·»åŠ æ’æ§½
        function addSlot() {
            alert('ğŸ”Œ æ–°é€»è¾‘çƒ­æ’å…¥!\n\nåœ¨ ALIN ä¸­ï¼Œåªéœ€:\nln -sf node_crypto active/05_crypto\n\næ— éœ€é‡å¯ï¼Œå³æ’å³ç”¨!');
        }

        // åˆå§‹åŒ–
        window.onload = () => {
            resizeCanvas();
            animateParticles();
            initThroughput();
        };
        window.onresize = resizeCanvas;
    </script>
</body>

</html>